@using enums = FeatureDemandPlanning.Model.Enumerations

@model FeatureDemandPlanning.Model.ViewModel.TakeRateViewModel

<th class="cross-tab-data-item feature-description">Description</th>
<th class="cross-tab-data-item feature-code">Code</th>
<th class="text-right model-mix">
    @if (Model.Document.Mode == enums.TakeRateResultMode.PercentageTakeRate)
    {
        @:% Mix
    }
    else
    {
        @:Volume
    }
</th>
@foreach (var availableModel in Model.Document.Vehicle.AvailableModels)
{
    var modelClassName = string.Empty;
    if (availableModel.FdpModelId.HasValue)
    {
        modelClassName = "fdp-model";
    }
    if (Model.Document.Mode == enums.TakeRateResultMode.PercentageTakeRate)
    {
        <th class="text-center model-mix @RenderEditableClass() @modelClassName" data-target="@Model.Document.Market.Id|@availableModel.StringIdentifier">
            @{
        var summary = Model.Document.TakeRateData.TakeRateSummaryByModel.Where(s => s.StringIdentifier == availableModel.StringIdentifier).FirstOrDefault();
        var percentage = "-";
        if (summary != null)
        {
            percentage = string.Format("{0:P2}", summary.PercentageOfFilteredVolume);
        }
        @percentage
            }
        </th>
    }
    else
    {
        <th class="text-center model-mix @RenderEditableClass() @modelClassName" data-target="MS|@Model.Document.Market.Id|@availableModel.StringIdentifier">
            @{
        var summary = Model.Document.TakeRateData.TakeRateSummaryByModel.Where(s => s.StringIdentifier == availableModel.StringIdentifier).FirstOrDefault();
        var volume = "-";
        if (summary != null)
        {
            volume = summary.Volume.ToString();
        }
        @volume
            }
        </th>
    }
}

@helper RenderEditableClass()
{
    if (!(Model.Document.Market is FeatureDemandPlanning.Model.Empty.EmptyMarket))
    {
        @("editable-header")
    }
    else
    {
        @(string.Empty)
    }
}
